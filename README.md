# project-config-operator

This operators waches the CR ProjectConfig and if exists execute the following tasks:
- Get all projects
- On each project:
  - Validates if exists a secret with the name defined in CR spec.secretname. If not, creates the secret.

The project code scafolding and base configuration have been generated using:
```sh
operator-sdk new project-config-operator --type ansible --api-version=project.bt.com/v1alpha1 --kind=ProjectConfig
```

## Installation  
Requires cluster admin permissions.

These are the required steps:
1. Create the Custom Resource Definition:
```sh
oc create -f deploy/crds/project_v1alpha1_projectconfig_crd.yaml
```
2. Create the namespace for the operator
```sh
oc new-project project-config-operator
```
3. Create the role, service account and role binding
```sh
oc create -f deploy/role.yaml
oc create -f deploy/service_account.yaml
oc adm policy add-cluster-role-to-user project-config-operator -z project-config-operator -n project-config-operator
```
4. Build operator image and create the operator
```sh
operator-sdk build project-config-operator:v1.0.0
# Update image reference in operator.yaml
oc create -f deploy/operator.yaml -n project-config-operator
```
5. Create a Custom Resource
```sh
oc create -f deploy/crds/project_v1alpha1_projectconfig_cr.yaml
```

## TODO
- Create a label validatio to only review certain projects. This label could be automatically added to projects editing the default template 
- Clean up autogenerated folders and files
- Validate the use of k8s_facts or k8s_info depending on ansible version (k8s_info if 2.7 or greater)
- Use ansible playbook?